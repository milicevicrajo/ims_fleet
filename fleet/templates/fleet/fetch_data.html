{% extends "base.html" %}
{% block content %}


<h1>Povlačenje podataka za sve funkcije</h1>

<!-- Forma za povlačenje podataka za Policy -->
<form method="post" action="{% url 'fetch_policies' %}">
    {% csrf_token %}
    <h2>Povlačenje podataka o polisama osiguranja</h2>
    <label for="days_policy">Broj dana (opciono):</label>
    <input type="text" id="days_policy" name="days" placeholder="Unesite broj dana">
    <button type="submit">Povuci podatke za Policy</button>
</form>

<hr>

<!-- Forma za povlačenje podataka za ServiceTransaction -->
<form method="post" action="{% url 'fetch_services' %}">
    {% csrf_token %}
    <h2>Povlačenje podataka o servisnim transakcijama</h2>
    <label for="days_service">Broj dana (opciono):</label>
    <input type="text" id="days_service" name="days" placeholder="Unesite broj dana">
    <button type="submit">Povuci podatke za ServiceTransaction</button>
</form>

<hr>

<!-- Forma za povlačenje podataka za Requisition -->
<form method="post" action="{% url 'fetch_requisitions' %}">
    {% csrf_token %}
    <h2>Povlačenje podataka o trebovanjima/zahtevima</h2>
    <label for="days_requisition">Broj dana (opciono):</label>
    <input type="text" id="days_requisition" name="days" placeholder="Unesite broj dana">
    <button type="submit">Povuci podatke za Requisition</button>
</form>

<hr>
<h2>Fetching Podataka za GORIVO</h2>
<p>Izaberite komandu za fetching podataka i pokrenite je:</p>
<form method="post" id="commandForm">
    {% csrf_token %}
    <div class="mb-3">
        <label for="command" class="form-label">Izaberite komandu:</label>
        <select id="command" name="command" class="form-select">
            <option value="nis_command">NIS Komanda</option>
            <option value="omv_command_putnicka">OMV Putnička Komanda</option>
            <option value="omv_command_teretna">OMV Teretna Komanda</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Pokreni</button>
</form>

<div id="responseMessage" class="mt-3"></div>


<script>
    document.getElementById('commandForm').addEventListener('submit', function(e) {
        e.preventDefault(); // Sprečava reload stranice
        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            const messageDiv = document.getElementById('responseMessage');
            if (data.status === 'success') {
                messageDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            } else {
                messageDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
            }
        })
        .catch(error => {
            document.getElementById('responseMessage').innerHTML = 
                `<div class="alert alert-danger">Greška prilikom izvršavanja komande.</div>`;
        });
    });
</script>
{% endblock %}
